# Helm Installation Guide for op-hello-world Operator

This guide explains how to install the HelloWorld operator using Helm.

## Prerequisites

- Kubernetes cluster (1.16+)
- Helm 3.x installed
- kubectl configured to access your cluster

## Installation Steps

### 1. Install from Local Chart

Since the Helm chart is generated in the `dist/chart` directory, you can install directly from there:

```bash
# Install the operator with default values
helm install op-hello-world ./dist/chart \
  --namespace op-hello-world-system \
  --create-namespace

# Or install with custom values
helm install op-hello-world ./dist/chart \
  --namespace op-hello-world-system \
  --create-namespace \
  --set controllerManager.replicas=2 \
  --set controllerManager.container.image.tag=v1.0.0
```

### 2. Verify Installation

```bash
# Check if the operator is running
kubectl get pods -n op-hello-world-system

# Check if CRDs are installed
kubectl get crd helloworlds.apps.example.com
```

### 3. Create a HelloWorld Resource

```bash
kubectl apply -f config/samples/apps_v1_helloworld.yaml
```

## Configuration Options

Key values you can override:

| Parameter | Description | Default |
|-----------|-------------|---------|
| `controllerManager.replicas` | Number of controller replicas | `1` |
| `controllerManager.container.image.repository` | Container image repository | `ghcr.io/j7m4/op-hello-world` |
| `controllerManager.container.image.tag` | Container image tag | `latest` |
| `controllerManager.container.resources.limits.cpu` | CPU limit | `500m` |
| `controllerManager.container.resources.limits.memory` | Memory limit | `128Mi` |
| `controllerManager.container.resources.requests.cpu` | CPU request | `10m` |
| `controllerManager.container.resources.requests.memory` | Memory request | `64Mi` |
| `rbac.enable` | Enable RBAC | `true` |
| `crd.enable` | Install CRDs | `true` |
| `crd.keep` | Keep CRDs on uninstall | `true` |
| `metrics.enable` | Enable metrics endpoint | `true` |
| `prometheus.enable` | Enable ServiceMonitor for Prometheus | `false` |

### Using a Custom values.yaml

Create a custom `values.yaml`:

```yaml
controllerManager:
  replicas: 2
  container:
    image:
      tag: v1.0.0
    resources:
      limits:
        cpu: 1000m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi

prometheus:
  enable: true
```

Then install with:

```bash
helm install op-hello-world ./dist/chart \
  --namespace op-hello-world-system \
  --create-namespace \
  -f custom-values.yaml
```

## Upgrade

To upgrade the operator:

```bash
helm upgrade op-hello-world ./dist/chart \
  --namespace op-hello-world-system
```

## Uninstall

To remove the operator:

```bash
helm uninstall op-hello-world --namespace op-hello-world-system
```

Note: By default, CRDs are kept after uninstall due to `crd.keep: true`. To remove CRDs manually:

```bash
kubectl delete crd helloworlds.apps.example.com
```

## Package the Chart

To create a packaged chart for distribution:

```bash
helm package ./dist/chart

# This creates op-hello-world-0.1.0.tgz
```

## Important Notes

- The Helm chart is generated by Kubebuilder and located in `dist/chart/`
- If you modify the operator code, regenerate the chart with: `kubebuilder edit --plugins=helm/v1-alpha`
- The chart includes all necessary RBAC permissions, CRDs, and deployment configurations